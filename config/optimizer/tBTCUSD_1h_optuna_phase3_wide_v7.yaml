# Optuna Hyperparameter Optimization Configuration - Phase 3 Wide Exploration (v7)
#
# Purpose:
#   Wide exploration of the parameter space to allow Optuna to find non-linear relationships
#   and novel strategies that might be missed by narrow fine-tuning.
#
# Phase Context:
#   - Builds on the realization that previous searches were too constrained.
#   - Focus: Exploration (High variance) over Exploitation.
#   - Strategy: Significantly widen search ranges for entry, regime, and structural parameters.
#   - Fixes (v7):
#     - ATR Period bug fixed (was hardcoded 14).
#     - Max Hold bug fixed.
#     - Commission updated to 0.2%.
#     - Warmup bars set to 150 (parity verified).
#
# Configuration Details:
#   - Symbol: tBTCUSD (Tokenized Bitcoin)
#   - Timeframe: 1 hour
#   - Data Snapshot: tBTCUSD_1h_2023-11-30_2025-11-19_v1 (~24 months)
#   - Optimization Runs: 200 trials with 2 concurrent workers
#   - Sampler: TPE with a large startup phase (50 random trials)
#
meta:
  symbol: tBTCUSD
  timeframe: 1h
  snapshot_id: tBTCUSD_1h_2023-11-30_2025-11-19_v1
  warmup_bars: 150
  runs:
    strategy: optuna
    resume: true
    max_trials: null
    max_concurrent: 2
    use_sample_range: true
    sample_start: 2023-11-30
    sample_end: 2025-11-19
    bootstrap_random_trials: 50 # Force 50 random trials before TPE takes over
    optuna:
      study_name: optuna_phase3_wide_v7
      storage: sqlite:///results/hparam_search/storage/optuna_phase3_wide_v7.db
      sampler:
        name: tpe
        kwargs:
          n_startup_trials: 50 # Match bootstrap
          n_ei_candidates: 24
          multivariate: true
          constant_liar: true
      timeout_seconds: 57300

constraints:
  min_trades: 30
  min_profit_factor: 1.05
  max_max_dd: 0.25 # Slightly relaxed for exploration
  include_scoring_failures: true

parameters:
  thresholds:
    entry_conf_overall:
      type: float
      low: 0.01
      high: 0.60
    regime_proba:
      balanced:
        type: float
        low: 0.35
        high: 0.90
      bull:
        type: float
        low: 0.35
        high: 0.90
      bear:
        type: float
        low: 0.35
        high: 0.90
      ranging:
        type: float
        low: 0.35
        high: 0.90
    min_edge:
      type: float
      low: 0.001
      high: 0.020
    signal_adaptation:
      atr_period:
        type: int
        low: 6
        high: 40
        step: 2
      zones:
        low:
          entry_conf_overall:
            type: float
            low: 0.05
            high: 0.50
        mid:
          entry_conf_overall:
            type: float
            low: 0.10
            high: 0.55
        high:
          entry_conf_overall:
            type: float
            low: 0.20
            high: 0.60

  htf_fib:
    entry:
      tolerance_atr:
        type: float
        low: 0.50
        high: 3.00
      long_max_level:
        type: grid
        values: [-0.10, -0.05, 0.0, 0.146, 0.20, 0.236, 0.382, 0.50, 0.618]
      short_min_level:
        type: grid
        values:
          [-0.272, -0.25, -0.236, -0.146, -0.05, 0.0, 0.146, 0.236, 0.35, 0.382]

  ltf_fib:
    entry:
      tolerance_atr:
        type: float
        low: 0.50
        high: 3.00
      long_max_level:
        type: grid
        values: [-0.10, -0.05, 0.0, 0.146, 0.20, 0.236, 0.382, 0.50, 0.618]
      short_min_level:
        type: grid
        values:
          [-0.272, -0.25, -0.236, -0.146, -0.05, 0.0, 0.146, 0.236, 0.35, 0.382]

  exit:
    exit_conf_threshold:
      type: float
      low: 0.30
      high: 0.60
    max_hold_bars:
      type: int
      low: 12
      high: 96
      step: 4
    trailing_stop_enabled:
      type: grid
      values: [true, false]
    trailing_stop_pct:
      type: float
      low: 0.01
      high: 0.05

  risk:
    risk_map_deltas:
      conf_0:
        type: float
        low: -0.05
        high: 0.05
      size_0:
        type: float
        low: -0.01
        high: 0.02
      conf_1:
        type: float
        low: -0.05
        high: 0.05
      size_1:
        type: float
        low: -0.01
        high: 0.02
      conf_2:
        type: float
        low: -0.05
        high: 0.05
      size_2:
        type: float
        low: -0.01
        high: 0.04

  multi_timeframe:
    ltf_override_threshold:
      type: float
      low: 0.50
      high: 0.80

  htf_exit_config:
    partial_1_pct:
      type: float
      low: 0.40
      high: 0.80
    partial_2_pct:
      type: float
      low: 0.30
      high: 0.70
    fib_threshold_atr:
      type: float
      low: 0.40
      high: 1.20
    trail_atr_multiplier:
      type: float
      low: 1.0
      high: 3.5
