# Champion-Centered Optuna Optimization - Smoke Test
#
# Purpose: Quick validation that optimization setup works correctly with 20x speedup
# Strategy: Small intervals around validated champion parameters (2-year PF 1.10)
# Duration: ~15-20 minutes (5 trials on 12 months data with precompute)
#
# Champion Baseline (2024 full year, 354 trades, +7.64%, PF 1.16):
#   entry_conf_overall: 0.09 → Test 0.08-0.12
#   signal_adaptation zones (low/mid/high) → Test ±15%
#   risk_map: [[0.4,0.02],[0.58,0.02],[0.63,0.04]] → Test higher positions
#   exit_conf_threshold: 0.38 → Test 0.33-0.45
#   max_hold_bars: 84 → Test 70-100
#   htf_fib.tolerance_atr: 1.6 → Test 1.3-2.0
#   ltf_fib.tolerance_atr: 1.4 → Test 1.1-1.8

meta:
  symbol: tBTCUSD
  timeframe: 1h
  snapshot_id: snap_tBTCUSD_20240101_20241231_v1 # 12 months for meaningful test
  warmup_bars: 150
  runs:
    strategy: optuna
    resume: false
    max_trials: 5
    max_concurrent: 1
    use_sample_range: true
    sample_start: 2024-01-01
    sample_end: 2024-12-31
    optuna:
      study_name: champion_centered_smoke_20241203_12m_v2
      storage: sqlite:///results/hparam_search/storage/champion_centered_smoke_20241203_12m.db
      sampler:
        name: tpe
        kwargs:
          n_startup_trials: 15
          n_ei_candidates: 24
          multivariate: true
          constant_liar: true

constraints:
  min_trades: 50 # 3 months, expect ~75-90 trades (champion baseline)
  min_profit_factor: 0.95 # Relaxed for Q1 test
  max_max_dd: 0.15 # Champion: 4.75%, allow up to 15% for Q1
  include_scoring_failures: false

parameters:
  # Top-level entry threshold (champion: 0.09)
  thresholds.entry_conf_overall:
    type: float
    low: 0.08
    high: 0.12
    step: 0.01

  # Signal adaptation zones - LOW zone (champion: 0.12 entry, 0.46 balanced)
  thresholds.signal_adaptation.zones.low.entry_conf_overall:
    type: float
    low: 0.10
    high: 0.15
    step: 0.01

  thresholds.signal_adaptation.zones.low.regime_proba.balanced:
    type: float
    low: 0.40
    high: 0.52
    step: 0.02

  # Signal adaptation zones - MID zone (champion: 0.30 entry, 0.50 balanced)
  thresholds.signal_adaptation.zones.mid.entry_conf_overall:
    type: float
    low: 0.26
    high: 0.34
    step: 0.02

  thresholds.signal_adaptation.zones.mid.regime_proba.balanced:
    type: float
    low: 0.44
    high: 0.56
    step: 0.02

  # Signal adaptation zones - HIGH zone (champion: 0.38 entry, 0.55 balanced)
  thresholds.signal_adaptation.zones.high.entry_conf_overall:
    type: float
    low: 0.34
    high: 0.42
    step: 0.02

  thresholds.signal_adaptation.zones.high.regime_proba.balanced:
    type: float
    low: 0.50
    high: 0.60
    step: 0.02

  # Risk map - test higher position sizes
  risk.risk_map:
    type: grid
    values:
      - [[0.4, 0.020], [0.58, 0.020], [0.63, 0.040]] # Champion baseline
      - [[0.4, 0.025], [0.58, 0.030], [0.63, 0.050]] # More aggressive
      - [[0.4, 0.015], [0.58, 0.025], [0.63, 0.035]] # More conservative

  # Exit config (champion: 0.38 conf, 84 bars)
  exit.exit_conf_threshold:
    type: float
    low: 0.33
    high: 0.45
    step: 0.02

  exit.max_hold_bars:
    type: int
    low: 70
    high: 100
    step: 10

  # Fibonacci tolerances (champion: HTF 1.6, LTF 1.4)
  htf_fib.entry.tolerance_atr:
    type: float
    low: 1.3
    high: 2.0
    step: 0.1

  ltf_fib.entry.tolerance_atr:
    type: float
    low: 1.1
    high: 1.8
    step: 0.1

  # LTF override threshold (champion: 0.66)
  multi_timeframe.ltf_override_threshold:
    type: float
    low: 0.60
    high: 0.75
    step: 0.05
