description: "Phase 3 Fine Tuning v7 (50 trials) - Fixed Risk Map Deltas"
# Based on Champion tBTCUSD_1h (PF 1.25, 201 trades)
# Changes from v3:
# - Fixed risk_map_deltas to prevent 0 position size (size_0, size_1)
# - Widened entry_conf_overall slightly (0.18 - 0.30) to ensure trades
# - Relaxed min_edge slightly (0.005 - 0.015)

meta:
  symbol: tBTCUSD
  timeframe: 1h
  snapshot_id: snap_tBTCUSD_2024-01-01_2024-12-31_v1
  runs:
    strategy: optuna
    resume: false
    max_trials: 50
    max_concurrent: 1
    optuna:
      study_name: "optuna_phase3_fine_v7_50"
      storage: "sqlite:///results/hparam_search/storage/optuna_phase3_fine_v7_50.db"
      n_jobs: 1
      timeout: 14400
      pruner:
        type: "median"
        n_startup_trials: 10
        n_warmup_steps: 2000
        interval_steps: 100
      sampler:
        type: "tpe"
        n_startup_trials: 20
        n_ei_candidates: 24
        multivariate: true
        group: true
        seed: 42

constraints:
  min_trades: 50
  min_profit_factor: 1.01
  max_max_dd: 0.15
  include_scoring_failures: true

parameters:
  # 1. Thresholds - Centered on Champion (0.24)
  thresholds:
    entry_conf_overall:
      type: float
      low: 0.18
      high: 0.30
      step: 0.01

    regime_proba:
      balanced:
        type: fixed
        value: 0.46
      bull:
        type: fixed
        value: 0.50
      bear:
        type: fixed
        value: 0.44
      ranging:
        type: fixed
        value: 0.46

    min_edge:
      type: float
      low: 0.005
      high: 0.012
      step: 0.001

    # 2. Signal Adaptation - Optimized ranges
    signal_adaptation:
      atr_period:
        type: fixed
        value: 28
      zones:
        low:
          entry_conf_overall:
            type: float
            low: 0.20
            high: 0.30
            step: 0.01
          regime_proba:
            type: float
            low: 0.30
            high: 0.42
            step: 0.01
        mid:
          entry_conf_overall:
            type: float
            low: 0.28
            high: 0.36
            step: 0.01
          regime_proba:
            type: float
            low: 0.40
            high: 0.50
            step: 0.01
        high:
          entry_conf_overall:
            type: float
            low: 0.34
            high: 0.42
            step: 0.01
          regime_proba:
            type: float
            low: 0.50
            high: 0.62
            step: 0.01

  # 3. Exit Strategy - Fine tuning around 0.42 / 12 bars
  exit:
    exit_conf_threshold:
      type: float
      low: 0.38
      high: 0.48
      step: 0.01
    max_hold_bars:
      type: int
      low: 8
      high: 24
      step: 2
    trailing_stop_pct:
      type: float
      low: 0.01
      high: 0.025
      step: 0.0025

  # 4. Multi-Timeframe - Centered on 0.36
  multi_timeframe:
    ltf_override_threshold:
      type: float
      low: 0.30
      high: 0.45
      step: 0.01
    ltf_override_adaptive:
      percentile:
        type: float
        low: 0.80
        high: 0.90
        step: 0.01

    # 5. Fibonacci Gates - Fine tuning tolerances
    htf_fib:
      entry:
        tolerance_atr:
          type: float
          low: 3.5
          high: 5.0
          step: 0.25

    ltf_fib:
      entry:
        tolerance_atr:
          type: float
          low: 1.4
          high: 2.2
          step: 0.1

  # 5. Risk Management - Risk Map Deltas
  risk:
    risk_map_deltas:
      conf_0:
        type: float
        low: -0.25
        high: -0.05
        step: 0.01
      size_0:
        type: float
        low: -0.005
        high: 0.005
        step: 0.001
      conf_1:
        type: float
        low: -0.25
        high: -0.05
        step: 0.01
      size_1:
        type: float
        low: -0.005
        high: 0.005
        step: 0.001
      conf_2:
        type: float
        low: -0.20
        high: 0.00
        step: 0.01
      size_2:
        type: float
        low: -0.02
        high: 0.02
        step: 0.005
