# Optuna configuration for Phase 3 Stabilization (V4 - Sniper Mode)
# Target: PF > 1.10, 50-200 trades/year
# Adjustments: Stricter entry, longer holds to overcome 0.5% fees

meta:
  symbol: "tBTCUSD"
  timeframe: "1h"
  snapshot_id: "snap_tBTCUSD_2024-01-01_2024-12-31_v1"
  runs:
    strategy: "optuna"
    max_trials: 10
    max_concurrent: 1
    optuna:
      study_name: "tBTCUSD_1h_phase3_stabilized_v4"
      storage: "sqlite:///results/hparam_search/storage/optuna_phase3_stabilized_v4.db"
      direction: "maximize"
      timeout_seconds: 14400 # 4 hours
      sampler:
        type: "TPE"
        kwargs:
          n_startup_trials: 20
          n_ei_candidates: 24
          seed: 42

# Parameter search space
parameters:
  # --- Entry Thresholds (Stricter) ---
  thresholds.entry_conf_overall:
    type: float
    low: 0.35
    high: 0.45
    step: 0.01

  thresholds.min_edge:
    type: float
    low: 0.01
    high: 0.025
    step: 0.001

  # --- Signal Adaptation (The "Cliff" Tuner) ---
  thresholds.signal_adaptation.zones.low.entry_conf_overall:
    type: float
    low: 0.32
    high: 0.38
    step: 0.01
  thresholds.signal_adaptation.zones.low.regime_proba:
    type: float
    low: 0.40
    high: 0.55
    step: 0.01

  thresholds.signal_adaptation.zones.mid.entry_conf_overall:
    type: float
    low: 0.35
    high: 0.42
    step: 0.01
  thresholds.signal_adaptation.zones.mid.regime_proba:
    type: float
    low: 0.45
    high: 0.60
    step: 0.01

  thresholds.signal_adaptation.zones.high.entry_conf_overall:
    type: float
    low: 0.40
    high: 0.50
    step: 0.01
  thresholds.signal_adaptation.zones.high.regime_proba:
    type: float
    low: 0.60
    high: 0.75
    step: 0.01

  # --- Exits (Longer Holds) ---
  exit.exit_conf_threshold:
    type: float
    low: 0.40
    high: 0.55
    step: 0.01

  exit.max_hold_bars:
    type: int
    low: 24
    high: 96
    step: 4

  exit.trailing_stop_pct:
    type: float
    low: 0.015
    high: 0.05
    step: 0.005

  # --- Multi-Timeframe (Medium Tolerances) ---
  multi_timeframe.ltf_override_threshold:
    type: float
    low: 0.40
    high: 0.60
    step: 0.01

  multi_timeframe.ltf_override_adaptive.percentile:
    type: float
    low: 0.85
    high: 0.98
    step: 0.01

  multi_timeframe.htf_fib.entry.tolerance_atr:
    type: float
    low: 1.5
    high: 3.0
    step: 0.25

  multi_timeframe.ltf_fib.entry.tolerance_atr:
    type: float
    low: 1.0
    high: 2.5
    step: 0.1

  # --- Risk Management (Aggressive on High Conf) ---
  risk.risk_map_deltas.conf_0:
    type: float
    low: -0.10
    high: 0.0
    step: 0.01
  risk.risk_map_deltas.size_0:
    type: float
    low: -0.005
    high: 0.005
    step: 0.001

  risk.risk_map_deltas.conf_1:
    type: float
    low: -0.12
    high: -0.02
    step: 0.01
  risk.risk_map_deltas.size_1:
    type: float
    low: -0.005
    high: 0.005
    step: 0.001

  risk.risk_map_deltas.conf_2:
    type: float
    low: -0.15
    high: -0.05
    step: 0.01
  risk.risk_map_deltas.size_2:
    type: float
    low: -0.015
    high: 0.015
    step: 0.005

# Constraints
constraints:
  min_trades: 30
  min_profit_factor: 1.05
  max_max_dd: 0.25
  include_scoring_failures: true
