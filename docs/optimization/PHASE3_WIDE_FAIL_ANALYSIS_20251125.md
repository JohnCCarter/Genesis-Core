# Phase 3 Wide Optimization Failure Analysis (2025-11-25)

## Incident Overview

The optimization run `run_20251125_082700` (Phase 3 Wide) crashed at trial 177 due to a `sqlite3.OperationalError: disk I/O error`.
More importantly, analysis of the 177 completed trials revealed a **strategic failure**:

- **Zero Valid Trials**: All trials failed the `min_trades: 30` constraint.
- **Low Trade Count**: Most trials produced only ~5 trades over the 12-month period.
- **Root Cause**: Aggressive Fibonacci gating (`LTF_FIB_BLOCK`) prevented entries even with "Wide" parameters.

## Technical Failure (SQLite Crash)

- **Error**: `sqlite3.OperationalError: disk I/O error`
- **Context**: Occurred during `study.tell()` in `runner.py`.
- **Cause**: High concurrency (`max_concurrent: 4`) on a file-based SQLite database likely caused locking contention or file system limits, especially with the large journal files generated by WAL mode.
- **Remediation**: Reduce `max_concurrent` to 1 or 2 for future runs, or switch to a server-based DB (PostgreSQL) if scaling is needed. For now, reducing concurrency is sufficient.

## Strategic Failure (Fibonacci Blocking)

- **Symptom**: Logs show repeated `[DECISION] LTF_FIB_BLOCK {'reason': 'LONG_ABOVE_LEVEL', ...}`.
- **Mechanism**: The strategy enforces "Buy Low, Sell High" within a swing using Fibonacci levels.
  - `LONG` entries are blocked if `price > long_max_level + tolerance`.
  - `SHORT` entries are blocked if `price < short_min_level - tolerance`.
- **Configuration Issue**:
  - `long_max_level` was fixed at `0.786` (from `runtime.json`).
  - `short_min_level` was fixed at `0.382`.
  - `tolerance_atr` was optimized between `0.20` and `1.10`.
- **Analysis**: In strong trends, price often exceeds the 78.6% retracement (approaching the high) or breaks out. The fixed levels combined with insufficient tolerance (even at 1.1 ATR) effectively blocked all breakout and strong trend-following trades.
- **Remediation**:
  - Add `long_max_level` and `short_min_level` to the optimization search space.
  - Allow values > 1.0 (for Long) and < 0.0 (for Short) to permit breakout entries.
  - Increase `tolerance_atr` upper bound to 2.0 or 3.0.

## Action Plan

1. **Modify Configuration**: Update `tBTCUSD_1h_optuna_phase3_wide.yaml` to include level parameters and wider tolerances.
2. **Reduce Concurrency**: Set `max_concurrent: 2` to prevent SQLite crashes.
3. **Restart Optimization**: Launch `optuna_phase3_wide_v2` with the corrected search space.
