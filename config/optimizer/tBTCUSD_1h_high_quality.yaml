# Optuna Hyperparameter Optimization Configuration - High Quality Test (v1)
#
# Purpose:
#   Test for "High Quality" trades (High Confidence, High Edge) with Maker fees.
#   Goal: Find a configuration with PF > 1.20, even if trade count is low.
#
# Configuration Details:
#   - Symbol: tBTCUSD
#   - Timeframe: 1h
#   - Commission: 0.1% (Maker)
#   - Slippage: 0.0% (Limit Order assumption)
#   - Optimization Runs: 50 trials
#
meta:
  symbol: tBTCUSD
  timeframe: 1h
  snapshot_id: tBTCUSD_1h_2023-11-30_2025-11-19_v1
  warmup_bars: 150
  runs:
    strategy: optuna
    resume: false
    max_trials: 10
    max_concurrent: 4
    use_sample_range: true
    sample_start: 2025-06-01
    sample_end: 2025-11-19
    bootstrap_random_trials: 20
    optuna:
      study_name: optuna_high_quality_v2
      storage: sqlite:///results/hparam_search/storage/optuna_high_quality_v2.db
      sampler:
        name: tpe
        kwargs:
          n_startup_trials: 15
          n_ei_candidates: 24
          multivariate: true
          constant_liar: true
      pruner:
        name: none
        kwargs: {}
      timeout_seconds: 3600

overrides:
  commission: 0.001
  slippage: 0.0

constraints:
  min_trades: 3
  max_trades: 100
  min_profit_factor: 0.80
  max_max_dd: 0.30
  max_total_commission_pct: 0.05
  include_scoring_failures: true

parameters:
  thresholds:
    entry_conf_overall:
      type: float
      low: 0.24
      high: 0.40
    regime_proba:
      balanced:
        type: float
        low: 0.44
        high: 0.95
      bull:
        type: float
        low: 0.44
        high: 0.95
      bear:
        type: float
        low: 0.44
        high: 0.95
      ranging:
        type: float
        low: 0.44
        high: 0.95
    min_edge:
      type: float
      low: 0.004
      high: 0.012
    signal_adaptation:
      atr_period:
        type: int
        low: 14
        high: 40
        step: 2
      zones:
        low:
          entry_conf_overall:
            type: float
            low: 0.22
            high: 0.38
        mid:
          entry_conf_overall:
            type: float
            low: 0.26
            high: 0.44
        high:
          entry_conf_overall:
            type: float
            low: 0.30
            high: 0.52

  htf_fib:
    entry:
      tolerance_atr:
        type: float
        low: 0.25
        high: 1.5
      long_max_level:
        type: grid
        values: [0.382, 0.5, 0.618, 0.786]
      short_min_level:
        type: grid
        values: [-0.382, -0.5, -0.618, -0.786]

  ltf_fib:
    entry:
      tolerance_atr:
        type: float
        low: 0.25
        high: 1.5
      long_max_level:
        type: grid
        values: [0.236, 0.382, 0.5]
      short_min_level:
        type: grid
        values: [-0.236, -0.382, -0.5]

  exit:
    exit_conf_threshold:
      type: float
      low: 0.30
      high: 0.70
    max_hold_bars:
      type: int
      low: 12
      high: 96
      step: 4
    trailing_stop_enabled:
      type: grid
      values: [true, false]
    trailing_stop_pct:
      type: float
      low: 0.005
      high: 0.050

  risk:
    risk_map_deltas:
      conf_0:
        type: float
        low: 0.0
        high: 0.10
      size_0:
        type: float
        low: 0.0
        high: 0.02
      conf_1:
        type: float
        low: 0.0
        high: 0.10
      size_1:
        type: float
        low: 0.0
        high: 0.02
      conf_2:
        type: float
        low: 0.0
        high: 0.10
      size_2:
        type: float
        low: 0.0
        high: 0.02

  multi_timeframe:
    ltf_override_threshold:
      type: float
      low: 0.70
      high: 0.95

  htf_exit_config:
    partial_1_pct:
      type: float
      low: 0.3
      high: 0.8
    partial_2_pct:
      type: float
      low: 0.1
      high: 0.5
    fib_threshold_atr:
      type: float
      low: 0.5
      high: 1.5
    trail_atr_multiplier:
      type: float
      low: 1.5
      high: 4.0
