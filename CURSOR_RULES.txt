# Genesis-Core Trading System Rules

## Core Principles
- Pause on uncertainty. Verify with codebase_search + grep. No assumptions.
- Plan steps before acting. Work systematically and methodically.
- Continue until task is complete. Reflect on root cause vs symptom.
- Respond in Swedish unless specified. Use clear headings and ✅ markers.

## Project Context
Genesis-Core is a Python 3.11+ FastAPI trading system with:
- P1-P3: Feature extraction (EMA+RSI), probability model with calibration, confidence/regime/decision
- P4: E2E pipeline with observability
- Bitfinex integration (REST + WebSocket)
- Paper trading only with TEST symbols (tTESTBTC:TESTUSD whitelist)

## Code Standards
- Python 3.11+: Use modern syntax (dict not Dict, X|None not Optional[X])
- Line length: 100 chars, black formatting, ruff linting
- Structure: src/core/{config,indicators,io,observability,risk,strategy,utils}
- Testing: pytest with comprehensive coverage

## Critical Security Rules
- NEVER commit: .env, .nonce_tracker.json, dev.overrides.local.json
- API keys only from environment variables
- Force TEST symbols for paper trading
- Use compact JSON for signing: json.dumps(body, separators=(",",":"))

## Development Workflow
1. Before changes: read_file → codebase_search → grep → todo_write
2. Making changes: Use edit tools (never output code), prefer editing over creating
3. Testing: pytest → black --check → ruff check → bandit
4. Git: Descriptive commits (feat:/fix:/security:), update .gitignore first

## FastAPI Endpoints
/ui (dashboard), /strategy/evaluate (pipeline), /public/candles (market data),
/auth/check (verify auth), /paper/submit (TEST orders only), /debug/auth,
/health, /metrics, /account/wallets, /account/positions, /account/orders,
/config/runtime, /config/runtime/validate, /config/runtime/propose

## Common Issues
- "invalid key": Check JSON serialization consistency
- "Ingen giltig order": Verify model exists, check risk config
- Nonce errors: Use bump_nonce() for retry
- WebSocket timeout: Implement exponential backoff

## Key Files
- src/core/server.py: FastAPI application and endpoints
- src/core/strategy/evaluate.py: E2E pipeline orchestration
- src/core/io/bitfinex/exchange_client.py: API integration
- config/models/: Model configurations and registry
- .env: API keys (BITFINEX_API_KEY, BITFINEX_API_SECRET)

## Response Format
- Swedish language with clear structure
- Show progress with ✅ checkmarks
- Explain problems with solutions
- Quality over speed, security first
