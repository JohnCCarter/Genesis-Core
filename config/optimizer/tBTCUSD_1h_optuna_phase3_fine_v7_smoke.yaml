# Optimization Config for tBTCUSD 1h (Phase 3 Fine Tuning - v7 Smoke)
# Based on v7 but with fewer trials for verification

meta:
  symbol: tBTCUSD
  timeframe: 1h
  snapshot_id: snap_tBTCUSD_2024-01-01_2024-12-31_v1
  runs:
    strategy: optuna
    resume: false
    max_trials: 10
    max_concurrent: 1
    optuna:
      study_name: "optuna_phase3_fine_v7_smoke"
      storage: "sqlite:///results/hparam_search/storage/optuna_phase3_fine_v7_smoke.db"
      n_jobs: 1
      sampler:
        type: "tpe"
        n_startup_trials: 5 # Half of trials are random
        n_ei_candidates: 24
        seed: 42 # Fixed seed for reproducibility
      objective:
        target: "score"
        direction: "maximize"
        timeout_seconds: 3600
      constraints:
        min_trades: 10 # Lower for smoke
        min_profit_factor: 0.5 # Very loose
        max_max_dd: 1.0 # No DD limit

# Parameter Search Space (Identical to v7)
parameters:
  # 1. Thresholds (Fine tuning)
  thresholds.entry_conf_overall:
    type: "float"
    low: 0.18
    high: 0.30
    step: 0.01

  thresholds.min_edge:
    type: "float"
    low: 0.005
    high: 0.015
    step: 0.001

  # 2. Exits (Fine tuning)
  exit.exit_conf_threshold:
    type: "float"
    low: 0.38
    high: 0.48
    step: 0.01

  exit.max_hold_bars:
    type: "int"
    low: 8
    high: 24
    step: 2

  exit.trailing_stop_pct:
    type: "float"
    low: 0.01
    high: 0.03
    step: 0.0025

  # 3. Multi-Timeframe (Logic toggles & thresholds)
  multi_timeframe.ltf_override_threshold:
    type: "float"
    low: 0.30
    high: 0.45
    step: 0.01

  multi_timeframe.ltf_override_adaptive.percentile:
    type: "float"
    low: 0.80
    high: 0.90
    step: 0.01

  # 4. Fibonacci Gates (Tolerances)
  htf_fib.entry.tolerance_atr:
    type: "float"
    low: 3.5
    high: 5.5
    step: 0.25

  ltf_fib.entry.tolerance_atr:
    type: "float"
    low: 1.0
    high: 2.0
    step: 0.1

  # 5. Risk Map Deltas (The Fix: Allow negative confidence deltas)
  risk.risk_map_deltas.conf_0:
    type: "float"
    low: -0.30 # Allow lowering confidence significantly
    high: 0.05
    step: 0.01

  risk.risk_map_deltas.size_0:
    type: "float"
    low: -0.005
    high: 0.005
    step: 0.001

  risk.risk_map_deltas.conf_1:
    type: "float"
    low: -0.20
    high: 0.05
    step: 0.01

  risk.risk_map_deltas.size_1:
    type: "float"
    low: -0.005
    high: 0.005
    step: 0.001

  risk.risk_map_deltas.conf_2:
    type: "float"
    low: -0.10
    high: 0.05
    step: 0.01

  risk.risk_map_deltas.size_2:
    type: "float"
    low: -0.015
    high: 0.020
    step: 0.005
